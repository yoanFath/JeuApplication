<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8">
    <title>Jeux</title>

    <link rel="stylesheet" type="text/css"
          href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.css"/>
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.20/css/dataTables.bootstrap4.min.css"/>
    <link rel="stylesheet" th:href="@{/css/style.css}">
    <script type="text/javascript" src="https://code.jquery.com/jquery-3.3.1.js"></script>
    <script type="text/javascript" src="https://cdn.datatables.net/1.10.20/js/jquery.dataTables.min.js"></script>
    <script type="text/javascript" src="https://cdn.datatables.net/1.10.20/js/dataTables.bootstrap4.min.js"></script>
</head>
<body>
<div th:replace="fragments/header :: header"></div>
<div class="main-content">
    <h1>Tous les jeux :</h1>
    <h2>
        <span th:text="'Hello, ' + ${message}"></span>
    </h2>

    <div class="row mb-1">
        <input class="form-control col-sm-2 ml-1" type="text" id="nom_jeu" name="nom_jeu" placeholder="nom_jeu">
        <input class="form-control col-sm-2 ml-1" type="text" id="genre" name="genre" placeholder="genre">
        <input class="form-control col-sm-2 ml-1" type="text" id="editeur" name="editeur" placeholder="editeur">
    </div>

    <button id="addJeu" type="button" class="btn btn-secondary">Ajouter un jeu</button>

    <div>
        <table id="example" class="table table-striped table-bordered ">
            <thead>
            <tr>
                <th>Name</th>
                <th>Genre</th>
                <th>Editeur</th>
                <th>Theme</th>
                <th>Type</th>
                <th>Age min</th>
                <th>Nb joueur min</th>
                <th>Nb joueur max</th>
                <th>Modifier</th>
                <th>Supprimer</th>
            </tr>
            </thead>

        </table>
    </div>
</div>

</body>
</html>

<script>
    $(document).ready(function () {
        var table = $('#example').DataTable({
            "processing": true,
            "ajax": {
                "url": "/api/jeu/all"
            },
            "columnDefs": [
                {"className": "dt-center", "targets": "_all"}
            ],
            "sAjaxDataProp": "",
            "columns": [
                {"data": "nom_jeu"},
                {"data": "genre.nom_genre"},
                {"data": "editeur.nom_editeur"},
                {"data": "theme.nom_theme"},
                {"data": "type.nom_type"},
                {"data": "age_minimum"},
                {"data": "nombre_joueurs_minimum"},
                {"data": "nombre_joueurs_maximum"},
                {"data": function(data){
                        // TODO appel ajax on click avec une image ou jsp
                        return "appeler : api/jeu/modifier/" + data.id + " avec le nom dans le body";
                    }},
                {"data": function(data){
                        // TODO appel ajax on click avec une image ou jsp
                        return "appeler api/jeu/delete/" + data.id;
                    }}
            ]
        });


        $('#genre').keyup(function () {
            table.column(1).search($("#genre").val()).draw();
        });
        $('#editeur').keyup(function () {
            table.column(2).search($("#editeur").val()).draw();
        });
        $('#nom_jeu').keyup(function () {
            table.column(0).search($("#nom_jeu").val()).draw();
        });

        $('#addJeu').click(function(e) {
            e.preventDefault(); // avoid to execute the actual submit of the form.

            var form = $(this);
            var url = form.attr('action');

            $.ajax({
                type: "POST",
                url: "/api/jeu/ajouter",
                data: form.serialize(), // serializes the form's elements.
                success: function(data)
                {
                    alert(data); // show response from the php script.
                }
            });

        });
    });


</script>
