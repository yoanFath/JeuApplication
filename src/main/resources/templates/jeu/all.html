<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8">
    <title>Jeux</title>

    <link rel="stylesheet" type="text/css"
          href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.css"/>
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.20/css/dataTables.bootstrap4.min.css"/>
    <link rel="stylesheet" th:href="@{/css/style.css}">
    <script type="text/javascript" src="https://code.jquery.com/jquery-3.3.1.js"></script>
    <script type="text/javascript" src="https://cdn.datatables.net/1.10.20/js/jquery.dataTables.min.js"></script>
    <script type="text/javascript" src="https://cdn.datatables.net/1.10.20/js/dataTables.bootstrap4.min.js"></script>
</head>
<body>
<div th:replace="fragments/header :: header"></div>
<div class="main-content">
    <h1>Tous les jeux :</h1>

    <div class="buttons">
        <a href="/jeu/ajouter" class="button" >Ajouter</a>
    </div>
    <div>
        <table id="example" class="table table-striped table-bordered">
            <thead>
            <tr>
                <th>Name</th>
                <th>Genre</th>
                <th>Editeur</th>
                <th>Theme</th>
                <th>Type</th>
                <th>Age min</th>
                <th>Nb joueur min</th>
                <th>Nb joueur max</th>
                <th>Modifier</th>
                <th>Supprimer</th>
            </tr>
            </thead>

        </table>
    </div>
</div>

</body>
</html>

<script type="text/javascript">
    var table;
    createDatable();

    function createDatable() {
        table = $('#example').DataTable({
            "processing": true,
            "ajax": {
                "url": "/api/jeu/all"
            },
            "columnDefs": [
                {"className": "dt-center", "targets": "_all"}
            ],
            "sAjaxDataProp": "",
            "columns": [
                {"data": "nom_jeu"},
                {"data": "genre.nom_genre"},
                {"data": "editeur.nom_editeur"},
                {"data": "theme.nom_theme"},
                {"data": "type.nom_type"},
                {"data": "age_minimum"},
                {"data": "nombre_joueurs_minimum"},
                {"data": "nombre_joueurs_maximum"},
                {
                    "data": function (data) {
                        return "<button type='button' onclick='updateEntity()'>Modifier</button>"
                    }
                },
                {
                    "data": function (data) {
                        return "<button type='button' class='red' onclick='deleteEntityGame(" + data.id + ")'>Supprimer</button>"
                    }
                }
            ]
        });
    }

    function deleteEntityGame(id) {
        const url = '/api/jeu/delete/' + id;
        $('.alert').addClass('hidden');
        $.post(url, {}, function() {
            table.ajax.reload();
            $('.alert-success').find('span').html('Votre suppression a bien été effectuée');
            $('.alert-success').removeClass('hidden');
        }).fail(function() {
            $('.alert-danger').find('span').html('Votre suppression a échoué, veuillez réessayer');
            $('.alert-danger').removeClass('hidde');
        });
    }

    $('#genre').keyup(function () {
        table.column(1).search($("#genre").val()).draw();
    });
    $('#editeur').keyup(function () {
        table.column(2).search($("#editeur").val()).draw();
    });
    $('#nom_jeu').keyup(function () {
        table.column(0).search($("#nom_jeu").val()).draw();
    });


</script>
